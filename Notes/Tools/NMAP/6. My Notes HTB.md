

| `-A` | Performs service detection, OS detection, traceroute and uses defaults scripts to scan the target. |
| ---- | -------------------------------------------------------------------------------------------------- |


```shell-session
sudo nmap 10.129.2.28 -p 80 -A
```






---
---

# Host Discovery -sn

```shell-session
sudo nmap 10.129.2.0/24 -sn

# -sn → “Ping scan” mode — only checks which hosts are **up**, doesn’t do port scanning.
```

---

If IP list is provided (hosts.lst)
```shell-session
sudo nmap -sn -iL hosts.lst

# -iL -> Performs defined scans against targets in provided 'hosts.lst' list.
```

we may see that some hosts are not shown, which nmap thinks as inactive remember, this may mean that these hosts ignore the default **ICMP echo requests** because of their firewall configurations. Since `Nmap` does not receive a response, it marks those hosts as inactive.

---

```shell-session
sudo nmap -sn 10.129.2.18 10.129.2.19 10.129.2.20 -vv
```

```shell-session
sudo nmap -sn 10.129.2.18-20 -vv
```

```shell-session
sudo nmap 10.129.2.18 -sn -vv
```

---

A way to determine why Nmap has our target marked as "alive" is with the "`--reason`" option

```shell-session
sudo nmap 10.129.2.18 -sn -PE --reason


# -PE -> Performs the ping scan by using 'ICMP Echo requests' against the target.
# --reason -> Displays the reason for specific result.
```

```shell-session
sudo nmap 10.129.2.18 -sn -PE --packet-trace
```

To disable ARP requests and scan our target with the desired `ICMP echo requests`, we can disable ARP pings by setting the "`--disable-arp-ping`" option.

```shell-session
sudo nmap 10.129.2.18 -sn -PE --packet-trace --disable-arp-ping 
```

#### TTL analysis

- When you ping a system, the TTL value starts at a default number set by the **operating system**.
- Common defaults:
    - **Linux / Unix / macOS** → TTL = 64
    - **Windows** → TTL = 128
    - **Cisco devices** → TTL = 255
Your captured response shows **TTL=128**, which matches **Windows**.

---
---

# Port Scanning -sV

|**State**|**Description**|
|---|---|
|`open`|This indicates that the connection to the scanned port has been established. These connections can be **TCP connections**, **UDP datagrams** as well as **SCTP associations**.|
|`closed`|When the port is shown as closed, the TCP protocol indicates that the packet we received back contains an `RST` flag. This scanning method can also be used to determine if our target is alive or not.|
|`filtered`|Nmap cannot correctly identify whether the scanned port is open or closed because either no response is returned from the target for the port or we get an error code from the target.|
|`unfiltered`|This state of a port only occurs during the **TCP-ACK** scan and means that the port is accessible, but it cannot be determined whether it is open or closed.|
|`open\|filtered`|If we do not get a response for a specific port, `Nmap` will set it to that state. This indicates that a firewall or packet filter may protect the port.|
|`closed\|filtered`|This state only occurs in the **IP ID idle** scans and indicates that it was impossible to determine if the scanned port is closed or filtered by a firewall.|

Defaults :-
-sS if sudo else -sT

-- Ports can be defined like
one by one (`-p 22,25,80,139,445`),
by range (`-p 22-445`),]
by top ports (`--top-ports=10`)
all ports (`-p-`)
top 100 ports (`-F`)

## SYN Scan

stealth

```shell-session
sudo nmap 10.129.2.28 --top-ports=10 -vv
```

## Connect Scan

less stealth, more accurate, takes more time, sometime bypasses firewall

```shell-session
sudo nmap 10.129.2.28 -p 443 --packet-trace --disable-arp-ping -Pn -n --reason -sT -vv
```

---
## Filtered Ports

When a port is shown as filtered, it can have several reasons. In most cases, firewalls have certain rules set to handle specific connections. The packets can either be `dropped`, or `rejected`. When a packet gets dropped, `Nmap` receives no response from our target, and by default, the retry rate (`--max-retries`) is set to `10`. This means `Nmap` will resend the request to the target port to determine if the previous packet was accidentally mishandled or not.

Let us look at an example where the firewall `drops` the TCP packets we send for the port scan. Therefore we scan the TCP port **139**, which was already shown as filtered. To be able to track how our sent packets are handled, we deactivate the ICMP echo requests (`-Pn`), DNS resolution (`-n`), and ARP ping scan (`--disable-arp-ping`) again.

  Host and Port Scanning

```shell-session
hellopriyanshu2702@htb[/htb]$ sudo nmap 10.129.2.28 -p 139 --packet-trace -n --disable-arp-ping -Pn

Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 15:45 CEST
SENT (0.0381s) TCP 10.10.14.2:60277 > 10.129.2.28:139 S ttl=47 id=14523 iplen=44  seq=4175236769 win=1024 <mss 1460>
SENT (1.0411s) TCP 10.10.14.2:60278 > 10.129.2.28:139 S ttl=45 id=7372 iplen=44  seq=4175171232 win=1024 <mss 1460>
Nmap scan report for 10.129.2.28
Host is up.

PORT    STATE    SERVICE
139/tcp filtered netbios-ssn
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 2.06 seconds
```

|**Scanning Options**|**Description**|
|---|---|
|`10.129.2.28`|Scans the specified target.|
|`-p 139`|Scans only the specified port.|
|`--packet-trace`|Shows all packets sent and received.|
|`-n`|Disables DNS resolution.|
|`--disable-arp-ping`|Disables ARP ping.|
|`-Pn`|Disables ICMP Echo requests.|


We see in the last scan that `Nmap` sent two TCP packets with the SYN flag. By the duration (`2.06s`) of the scan, we can recognize that it took much longer than the previous ones (`~0.05s`). The case is different if the firewall rejects the packets. For this, we look at TCP port `445`, which is handled accordingly by such a rule of the firewall.

  Host and Port Scanning

```shell-session
hellopriyanshu2702@htb[/htb]$ sudo nmap 10.129.2.28 -p 445 --packet-trace -n --disable-arp-ping -Pn

Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 15:55 CEST
SENT (0.0388s) TCP 10.129.2.28:52472 > 10.129.2.28:445 S ttl=49 id=21763 iplen=44  seq=1418633433 win=1024 <mss 1460>
RCVD (0.0487s) ICMP [10.129.2.28 > 10.129.2.28 Port 445 unreachable (type=3/code=3) ] IP [ttl=64 id=20998 iplen=72 ]
Nmap scan report for 10.129.2.28
Host is up (0.0099s latency).

PORT    STATE    SERVICE
445/tcp filtered microsoft-ds
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 0.05 seconds
```

|**Scanning Options**|**Description**|
|---|---|
|`10.129.2.28`|Scans the specified target.|
|`-p 445`|Scans only the specified port.|
|`--packet-trace`|Shows all packets sent and received.|
|`-n`|Disables DNS resolution.|
|`--disable-arp-ping`|Disables ARP ping.|
|`-Pn`|Disables ICMP Echo requests.|

As a response, we receive an `ICMP` reply with `type 3` and `error code 3`, which indicates that the desired port is unreachable. Nevertheless, if we know that the host is alive, we can strongly assume that the firewall on this port is rejecting the packets, and we will have to take a closer look at this port later.

---

# UDP Scan -sU

```shell-session
sudo nmap 10.129.2.28 -F -sU -vv
```

Reason (I didnt understood)
```shell-session
sudo nmap 10.129.2.28 -sU -Pn -n --disable-arp-ping --packet-trace -p 137 --reason -vv
```

```shell-session
sudo nmap 10.129.2.28 -sU -Pn -n --disable-arp-ping --packet-trace -p 138 --reason -vv
```

---

# Version Scan -sV

```shell-session
sudo nmap 10.129.2.28 -Pn -n --disable-arp-ping --packet-trace -p 445 --reason  -sV -vv
```

basically -sV

---
---

# Formats to save the output -oA


- Normal output (`-oN`) with the `.nmap` file extension
- Grepable output (`-oG`) with the `.gnmap` file extension
- XML output (`-oX`) with the `.xml` file extension
- All (`-oA`)

---
---

# Service Version Detection -sV

```shell-session
sudo nmap 10.129.2.28 -p- -sV -vv
```

### Banner Grabbing
I did not understood

```shell-session
sudo tcpdump -i eth0 host 10.10.14.2 and 10.129.2.28
```

```shell-session
nc -nv 10.129.2.28 25
```

---
---

# Nmap Scripting Engine -sC

|**Category**|**Description**|
|---|---|
|`auth`|Determination of authentication credentials.|
|`broadcast`|Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans.|
|`brute`|Executes scripts that try to log in to the respective service by brute-forcing with credentials.|
|`default`|Default scripts executed by using the `-sC` option.|
|`discovery`|Evaluation of accessible services.|
|`dos`|These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.|
|`exploit`|This category of scripts tries to exploit known vulnerabilities for the scanned port.|
|`external`|Scripts that use external services for further processing.|
|`fuzzer`|This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.|
|`intrusive`|Intrusive scripts that could negatively affect the target system.|
|`malware`|Checks if some malware infects the target system.|
|`safe`|Defensive scripts that do not perform intrusive and destructive access.|
|`version`|Extension for service detection.|
|`vuln`|Identification of specific vulnerabilities.|


#### Default Scripts

  Nmap Scripting Engine

```shell-session
hellopriyanshu2702@htb[/htb]$ sudo nmap <target> -sC -sV
```

#### Specific Scripts Category

  Nmap Scripting Engine

```shell-session
hellopriyanshu2702@htb[/htb]$ sudo nmap <target> --script <category> -sV
```

#### Defined Scripts

  Nmap Scripting Engine

```shell-session
hellopriyanshu2702@htb[/htb]$ sudo nmap <target> -sV --script <script-name>,<script-name>,...
```

#### All Scripts

```
sudo nmap --script=all -p80 <target>
```

#### HTTP-related scripts

```
sudo nmap --script "http-*" -sV -p80 <target>
```


